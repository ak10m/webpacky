# Webpacky ![](https://github.com/ak10m/webpack-ruby/workflows/CI/badge.svg)

A library that makes Ruby and Webpack as loosely coupled as possible.

## Installation

Add this line to your application's Gemfile:

```ruby
gem 'webpacky'
```

And then execute:

    $ bundle install

Or install it yourself as:

    $ gem install webpacky

## Usage

### Webpack::DevServer::Proxy

Rack Middleware for proxying access to a specific path to Webpack Dev Server.

```ruby
# config.ru

require 'webpacky'
require 'webpack/dev_server/proxy'

Webpacky.configure do |c|
  c.dev_server.url = 'http://localhost:9000'
  c.dev_server.proxy_path = '/web/pack'
end

use Webpack::DevServer::Proxy, ssl_verify_none: true

run lambda {|env| [200, {'Content-Type' => 'text/plain'}, ['Hello']] }
```

With a configuration like, access to `/web/pack/logo.svg` will be proxied to `http://localhost:9000/logo.svg`.


### Webpack::Manifest::Entries

Handles the manifest.json file generated by Webpack.

```ruby
# manifest.json
# {
#   "script.js": "script-abcd1234.js",
#   "style.css": "/bundles/style-abcd1234.css"
#   "logo.svg": "https://cdn/logo-abcd1234.svg"
# }

manifest = Webpack::Manifest::Entries.load '/path/to/manifest.json'
manifest.lookup! 'script.js'  # => 'script-abcd1234.js'
manifest.lookup! 'style.css'  # => '/bundles/stype-abcd1234.css'
manifest.lookup! 'logo.svg'   # => 'https://cdn/logo-abcd1234.svg'
manifest.lookup! 'unknown'    # => raise Webpack::Manifest::Entries::MissingEntryError
```


### Webpacky::Helper

Use `proxy_path` and` manifest.json` to return the proper URI as seen by the application.

```ruby
# manifest.json
# {
#   "script.js": "script-abcd1234.js",
#   "style.css": "/bundles/style-abcd1234.css"
#   "logo.svg": "https://cdn/logo-abcd1234.svg"
# }

require 'webpacky'

Webpacky.configure do |c|
  c.dev_server.url = 'http://localhost:9000'
  c.dev_server.proxy_path = '/web/pack'
  c.manifest.url = 'http://localhost:9000/manifest.json'
  c.manifest.cache = false
end

class Helper
  include Webpacky::Helper
end

helper = Helper.new

helper.webpack_bundle_path('script.js') # => '/web/pack/script-abcd1234.js'
helper.webpack_bundle_path('style.css') # => '/web/pack/bundles/style-abcd1234.css'
helper.webpack_bundle_path('logo.svg')  # => 'https://cdn/logo-abcd1234.svg'
helper.webpack_bundle_path('unknown')   # => raise Webpack::Manifest::Entries::MissingEntryError

# when `dev_server.proxy_path = false`

helper.webpack_bundle_path('script.js') # => 'script-abcd1234.js'
helper.webpack_bundle_path('style.css') # => '/bundles/style-abcd1234.css'
helper.webpack_bundle_path('logo.svg')  # => 'https://cdn/logo-abcd1234.svg'
helper.webpack_bundle_path('unknown')   # => raise Webpack::Manifest::Entries::MissingEntryError
```

### Rails support

By running the Rails generator command, you can generate a file in `config/initializers` to change the default configuration.

```shell
rails g webpacky:config
```

#### helper

You can use a helper that generates HTML tags according to Webpack's manifest.json.
(using `Webpacky::Helper` generated URI)

* javascript_bundle_tag
* stylesheet_bundle_tag
* image_bundle_tag


## Contributing

Bug reports and pull requests are welcome on GitHub at https://github.com/ak10m/webpacky.


## License

The gem is available as open source under the terms of the [MIT License](https://opensource.org/licenses/MIT).
